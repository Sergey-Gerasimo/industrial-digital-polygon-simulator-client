syntax = "proto3";

package simulator; 

// -----------------------------------------------------------------
//          Основные сообщения
// -----------------------------------------------------------------

message Supplier { 
    string supplier_id = 1;
    string name = 2;
    string product_name = 3;
    string material_type = 4;
    uint32 delivery_period = 5; 
    uint32 special_delivery_period = 6;
    double reliability = 7;
    double product_quality = 8;
    uint32 cost = 9; 
    uint32 special_delivery_cost = 10;
}

message Warehouse {
    string warehouse_id = 1; 
    Worker inventory_worker = 2; 
    uint32 size = 3; 
    uint32 loading = 4; 
    map<string, uint32> materials = 5;
}

message Worker {
    string worker_id = 1;
    string name = 2;
    uint32 qualification = 3;
    string specialty = 4;
    uint32 salary = 5;
}

message Logist { 
    string worker_id = 1;
    string name = 2;
    uint32 qualification = 3;
    string specialty = 4;
    uint32 salary = 5;
    // Скорость логиста. Максимальное значение: 2147483647 (для совместимости с int32 в PostgreSQL)
    uint32 speed = 6;
    string vehicle_type = 7;
}

message Equipment{
    string equipment_id = 1; 
    string name = 2;
    string equipment_type = 3;
    double reliability = 4;
    uint32 maintenance_period = 5;
    uint32 maintenance_cost = 6;
    uint32 cost = 7;
    uint32 repair_cost = 8;
    uint32 repair_time = 9;
}

message Workplace {
    string workplace_id = 1; 
    string workplace_name = 2; 
    string required_speciality = 3; 
    uint32 required_qualification = 4;
    string required_equipment = 5;
    Worker worker = 6; 
    Equipment equipment = 7;
    repeated string required_stages = 8;
    bool is_start_node = 9;      // является начальным узлом (поставщик)
    bool is_end_node = 10;        // является конечным узлом (потребитель)
    repeated string next_workplace_ids = 11; // следующие рабочие места
    optional uint32 x = 12;                // координата X на площадке 7x7 (0-6)
    optional uint32 y = 13;                // координата Y на площадке 7x7 (0-6)
}

message Route {
    uint32 length = 1; 
    string from_workplace = 2;
    string to_workplace = 3;
}

message ProcessGraph {
    string process_graph_id = 1;
    repeated Workplace workplaces = 2; 
    repeated Route routes = 3;
}

message Consumer{
    string consumer_id = 1;
    string name = 2;
    string type = 3;
}

message Tender {
    string tender_id = 1;
    Consumer consumer = 2;
    uint32 cost = 3;
    uint32 quantity_of_products = 4;
    uint32 penalty_per_day = 5;
    uint32 warranty_years = 6;
    string payment_form = 7;
}

// Стратегия распределения производственного плана
enum DistributionStrategy {
    DISTRIBUTION_STRATEGY_UNSPECIFIED = 0;
    DISTRIBUTION_STRATEGY_BALANCED = 1;      // равномерное распределение
    DISTRIBUTION_STRATEGY_EFFICIENT = 2;     // по эффективности
    DISTRIBUTION_STRATEGY_CUSTOM = 3;        // ручное распределение
    DISTRIBUTION_STRATEGY_PRIORITY_BASED = 4; // по приоритету
}

message SimulationParameters { 
    Logist logist = 1;
    repeated Supplier suppliers = 2;
    repeated Supplier backup_suppliers = 3;
    Warehouse materials_warehouse = 4;
    Warehouse product_warehouse = 5;
    ProcessGraph processes = 6;
    repeated Tender tenders = 7;
    string dealing_with_defects = 8;
    repeated LeanImprovement production_improvements = 10;
    string sales_strategy = 11;
    
    ProductionSchedule production_schedule = 16;
    repeated Certification certifications = 19;
    repeated LeanImprovement lean_improvements = 20;
    
    // Новые поля для распределения производственного плана
    DistributionStrategy distribution_strategy = 22;
    uint32 step = 24;
    uint32 capital = 25;
}

message SimulationResults{
    int64 profit = 1;
    int64 cost = 2;
    double profitability = 3;

    FactoryMetrics factory_metrics = 4;
    ProductionMetrics production_metrics = 5;
    QualityMetrics quality_metrics = 6;
    EngineeringMetrics engineering_metrics = 7;
    CommercialMetrics commercial_metrics = 8;
    ProcurementMetrics procurement_metrics = 9;

    uint32 step = 10;
}

message Simulation {
    uint32 capital = 1;
    string simulation_id = 2; 
    repeated SimulationParameters parameters = 3; 
    repeated SimulationResults results = 4; 
    string room_id = 5;
    bool is_completed = 6;
}

// -----------------------------------------------------------------
//          Новые сообщения для мониторинга и показателей
// -----------------------------------------------------------------

message FactoryMetrics {
    double profitability = 1;
    double on_time_delivery_rate = 2;
    double oee = 3;
    map<string, WarehouseMetrics> warehouse_metrics = 4;
    uint64 total_procurement_cost = 5;
    double defect_rate = 6;
}

message WarehouseMetrics {
    double fill_level = 1;
    uint32 current_load = 2;
    uint32 max_capacity = 3;
    map<string, uint32> material_levels = 4;
    repeated uint32 load_over_time = 5;  // Массив загруженности от времени
    repeated uint32 max_capacity_over_time = 6;  // Массив максимальной вместимости от времени
}

message ProductionMetrics {
    message MonthlyProductivity {
        string month = 1;
        uint32 units_produced = 2;
    }
    
    repeated MonthlyProductivity monthly_productivity = 1;
    double average_equipment_utilization = 2;
    uint32 wip_count = 3;
    uint32 finished_goods_count = 4;
    map<string, uint32> material_reserves = 5;
}

message QualityMetrics {
    double defect_percentage = 1;
    double good_output_percentage = 2;
    message DefectCause {
        string cause = 1;
        uint32 count = 2;
        double percentage = 3;
    }
    repeated DefectCause defect_causes = 3;
    double average_material_quality = 4;
    double average_supplier_failure_probability = 5;
    uint64 procurement_volume = 6;
}

message EngineeringMetrics {
    message OperationTiming {
        string operation_name = 1;
        uint32 cycle_time = 2;
        uint32 takt_time = 3;
        uint32 timing_cost = 4;
    }
    
    message DowntimeRecord {
        string cause = 1;
        uint32 total_minutes = 2;
        double average_per_shift = 3;
    }
    
    message DefectAnalysis {
        string defect_type = 1;
        uint32 count = 2;
        double percentage = 3;
        double cumulative_percentage = 4;
    }
    
    repeated OperationTiming operation_timings = 1;
    repeated DowntimeRecord downtime_records = 2;
    repeated DefectAnalysis defect_analysis = 3;
}

message CommercialMetrics {
    message YearlyRevenue {
        uint32 year = 1;
        uint64 revenue = 2;
    }
    
    repeated YearlyRevenue yearly_revenues = 1;
    uint64 tender_revenue_plan = 2;
    uint64 total_payments = 3;
    uint64 total_receipts = 4;
    map<string, double> sales_forecast = 5;
    map<string, uint64> strategy_costs = 6;
    
    message TenderGraphPoint {
        string strategy = 1;
        string unit_size = 2;
        bool is_mastered = 3;
    }
    repeated TenderGraphPoint tender_graph = 7;
    
    message ProjectProfitability {
        string project_name = 1;
        double profitability = 2;
    }
    repeated ProjectProfitability project_profitabilities = 8;
    
    uint32 on_time_completed_orders = 9;
}

message ProcurementMetrics {
    message SupplierPerformance {
        string supplier_id = 1;
        uint32 delivered_quantity = 2;
        double projected_defect_rate = 3;
        double planned_reliability = 4;
        double actual_reliability = 5;
        uint64 planned_cost = 6;
        uint64 actual_cost = 7;
        uint32 actual_defect_count = 8;
    }
    
    repeated SupplierPerformance supplier_performances = 1;
    uint64 total_procurement_value = 2;
}

// Производственный план: строка таблицы (соответствует одному тендеру)
message ProductionPlanRow {
    string tender_id = 1;                 // ID тендера (обязательная привязка, в тендере есть привязка к потребителю)
    string product_name = 2;              // Название продукта
    // Основные поля из продуктового плана
    uint32 priority = 14;                 // Приоритет №
    string plan_date = 15;                // План дата (DD.MM)
    string dse = 16;                      // ДСЕ (Design-Assembly Unit)
    string short_set = 17;                // Набор (коротк.)
    string dse_name = 18;                 // Наименование ДСЕ
    uint32 planned_quantity = 6;          // Кол-во план. (с ТО/без ТО)
    uint32 actual_quantity = 7;           // Кол-во факт.
    uint32 remaining_to_produce = 8;      // Осталось изготовить
    string provision_status = 19;         // Обеспеченность ("Обеспечено" / "Не обеспечено")
    string note = 20;                     // Примечание
    string planned_completion_date = 9;   // Плановая дата исполнения (DD.MM.YYYY)
    string cost_breakdown = 21;           // Разрез себестоимости
    string order_number = 10;             // Номер заказа
}

// Производственный план: объемно-календарный план (таблица строк по тендерам)
// При создании симуляции таблица создается автоматически с неполностью заполненными полями
// Количество строк равно количеству tenders в системе
message ProductionSchedule {
    repeated ProductionPlanRow rows = 1;   // Строки таблицы (по одной на каждый tender)
}

// Внеплановый ремонт
message UnplannedRepair {
    message RepairRecord {
        string month = 1;
        uint64 repair_cost = 2;
        string equipment_id = 3;
        string reason = 4;
    }
    
    repeated RepairRecord repairs = 1;
    uint64 total_repair_cost = 2;
}

message RequiredMaterial {
    string material_id = 1;
    string name = 2;
    bool has_contracted_supplier = 3;
    uint32 required_quantity = 4;
    uint32 current_stock = 5;
}

message Certification {
    string certificate_type = 1;
    bool is_obtained = 2;
    uint64 implementation_cost = 3;
    uint32 implementation_time_days = 4;
}

message LeanImprovement {
    string improvement_id = 1;
    string name = 2;
    bool is_implemented = 3;
    uint64 implementation_cost = 4;
    double efficiency_gain = 5;
}

message WarehouseLoadChart {
    message LoadPoint {
        string timestamp = 1;
        uint32 load = 2;
        uint32 max_capacity = 3;
    }
    
    repeated LoadPoint data_points = 1;
    string warehouse_id = 2;
}

// -----------------------------------------------------------------
//          Новые сообщения для графиков и диаграмм
// -----------------------------------------------------------------

message OperationTimingChart {
    message TimingData {
        string process_name = 1;
        uint32 cycle_time = 2;
        uint32 takt_time = 3;
        uint32 timing_cost = 4;
    }
    
    repeated TimingData timing_data = 1;
    string chart_type = 2;
}

message DowntimeChart {
    message DowntimeData {
        string process_name = 1;
        string cause = 2;
        uint32 downtime_minutes = 3;
    }
    
    repeated DowntimeData downtime_data = 1;
    string chart_type = 2;
}

message ModelMasteryChart {
    message ModelPoint {
        string strategy = 1;
        string unit_size = 2;
        bool is_mastered = 3;
        string model_name = 4;
    }
    
    repeated ModelPoint model_points = 1;
}

message ProjectProfitabilityChart {
    message ProjectData {
        string project_name = 1;
        double profitability = 2;
    }
    
    repeated ProjectData projects = 1;
    string chart_type = 2;
}

// -----------------------------------------------------------------
//          Сообщения для запросов и ответов
// -----------------------------------------------------------------


// Списки доступных опций (константы - простые списки строк)
message GetAvailableDefectPoliciesRequest {}

message DefectPoliciesListResponse {
    repeated string policies = 1;
    string timestamp = 2;
}

message GetAvailableImprovementsListRequest {}

message ImprovementsListResponse {
    repeated string improvements = 1;
    string timestamp = 2;
}

message GetAvailableCertificationsRequest {}

message CertificationsListResponse {
    repeated string certifications = 1;
    string timestamp = 2;
}

message GetAvailableSalesStrategiesRequest {}

message SalesStrategiesListResponse {
    repeated string strategies = 1;
    string timestamp = 2;
}

message GetMaterialTypesRequest {}

message MaterialTypesResponse {
    repeated string material_types = 1;
    string timestamp = 2;
}

message GetEquipmentTypesRequest {}

message EquipmentTypesResponse {
    repeated string equipment_types = 1;
    string timestamp = 2;
}

message GetWorkplaceTypesRequest {}

message WorkplaceTypesResponse {
    repeated string workplace_types = 1;
    string timestamp = 2;
}

message GetAvailableDealingWithDefectsRequest {}

message GetAvailableLeanImprovementsRequest {}

message CreateLeanImprovementRequest {
    string name = 1;
    bool is_implemented = 2;
    uint64 implementation_cost = 3;
    double efficiency_gain = 4;
}

message UpdateLeanImprovementRequest {
    string improvement_id = 1;
    string name = 2;
    bool is_implemented = 3;
    uint64 implementation_cost = 4;
    double efficiency_gain = 5;
}

message DeleteLeanImprovementRequest {
    string improvement_id = 1;
}

message GetAllLeanImprovementsRequest {}

message GetAllLeanImprovementsResponse {
    repeated LeanImprovement improvements = 1;
    uint32 total_count = 2;
}

message GetAvailableLeanImprovementsResponse {
    repeated LeanImprovement improvements = 1;
    string timestamp = 2;
}

// -----------------------------------------------------------------
//          Запросы для управления графом процесса
// -----------------------------------------------------------------

message UpdateProcessGraphRequest {
    string simulation_id = 1;
    ProcessGraph process_graph = 2;
}

// -----------------------------------------------------------------
//          Запросы для распределения плана (Производство)
// -----------------------------------------------------------------

// Установка/обновление строки производственного плана
// Строки нельзя удалять, только изменять. Получение происходит через SimulationResponse
message SetProductionPlanRowRequest {
    string simulation_id = 1;
    ProductionPlanRow row = 2;            // Строка таблицы для установки/обновления
}


// -----------------------------------------------------------------
//          Базовые запросы и ответы
// -----------------------------------------------------------------

message SimulationResponse {
    Simulation simulations = 1;
    string timestamp = 2;
}

message GetSimulationRequest {
    string simulation_id = 1; 
}

message SetLogistRequest {
    string simulation_id = 1; 
    string worker_id = 2; 
}

message AddSupplierRequest{
    string simulation_id = 1; 
    string supplier_id = 2; 
    bool is_backup = 3;
}

enum WarehouseType {
    WAREHOUSE_TYPE_UNSPECIFIED = 0;
    WAREHOUSE_TYPE_MATERIALS = 1;
    WAREHOUSE_TYPE_PRODUCTS = 2;
}

message SetWarehouseInventoryWorkerRequest{
    string simulation_id = 1; 
    string worker_id = 2; 
    WarehouseType warehouse_type = 3;
}

message IncreaseWarehouseSizeRequest{
    string simulation_id = 1; 
    WarehouseType warehouse_type = 2;
    uint32 size = 3;
}

message AddTenderRequest{
    string simulation_id = 1; 
    string tender_id = 2;
}

message RemoveTenderRequest{
    string simulation_id = 1; 
    string tender_id = 2;
}

message SetDealingWithDefectsRequest{
    string simulation_id = 1; 
    string dealing_with_defects = 2;
}


message DeleteSupplierRequest{
    string simulation_id = 1; 
    string supplier_id = 2;
}


message RunSimulationRequest{
    string simulation_id = 1; 
}


message SetWorkerOnWorkerplaceRequest{
    string simulation_id = 1; 
    string worker_id = 2; 
    string workplace_id = 3; 
}

message UnSetWorkerOnWorkerplaceRequest{
    string simulation_id = 1; 
    string worker_id = 2; 
}

message CreateSimulationRquest{

}


message SuccessResponse{
    bool success = 1; 
    string message = 2; 
    string timestamp = 3;
}

// -----------------------------------------------------------------
//          Запросы для Database Manager
// -----------------------------------------------------------------

message CreateSupplierRequest {
    string name = 1; 
    string product_name = 2;
    string material_type = 3;
    uint32 delivery_period = 4; 
    uint32 special_delivery_period = 5;
    double reliability = 6; 
    double product_quality = 7;
    uint32 cost = 8;
    uint32 special_delivery_cost = 9;
}

message UpdateSupplierRequest {
    string supplier_id = 1; 
    string name = 2; 
    string product_name = 3;
    string material_type = 4;
    uint32 delivery_period = 5; 
    uint32 special_delivery_period = 6;
    double reliability = 7; 
    double product_quality = 8;
    uint32 cost = 9;
    uint32 special_delivery_cost = 10;
}

message GetAllSuppliersResponse {
  repeated Supplier suppliers = 1;
  uint32 total_count = 2;
}

message GetWarehouseRequest {
    string warehouse_id = 1; 
}

message CreateWorkerRequest{
    string name = 1;
    uint32 qualification = 2;
    string specialty = 3;
    uint32 salary = 4;
}

message UpdateWorkerRequest{
    string worker_id = 1;
    string name = 2;
    uint32 qualification = 3;
    string specialty = 4;
    uint32 salary = 5;
}

message DeleteWorkerRequest {
    string worker_id = 1; 
}

message GetAllWorkersResponse{
    repeated Worker workers = 1;
    uint32 total_count = 2;
}

message CreateLogistRequest{
    string name = 1;
    uint32 qualification = 2;
    string specialty = 3;
    uint32 salary = 4;
    // Скорость логиста. Максимальное значение: 2147483647 (для совместимости с int32 в PostgreSQL)
    uint32 speed = 5;
    string vehicle_type = 6;
}

message UpdateLogistRequest {
    string worker_id = 1;
    string name = 2;
    uint32 qualification = 3;
    string specialty = 4;
    uint32 salary = 5;
    // Скорость логиста. Максимальное значение: 2147483647 (для совместимости с int32 в PostgreSQL)
    uint32 speed = 6;
    string vehicle_type = 7;
}

message DeleteLogistRequest{
    string worker_id = 1;
}

message GetAllLogistsResponse{
    repeated Logist logists = 1;
    uint32 total_count = 2;
}

message CreateWorkplaceRequest{
    string workplace_name = 1; 
    string required_speciality = 2; 
    uint32 required_qualification = 3; 
    string required_equipment = 4;
    repeated string required_stages = 5;
}

message UpdateWorkplaceRequest{
    string workplace_id = 1; 
    string workplace_name = 2; 
    string required_speciality = 3; 
    uint32 required_qualification = 4; 
    string required_equipment = 5;
    repeated string required_stages = 6;
}

message DeleteWorkplaceRequest{
    string workplace_id = 1;
}

message GetAllWorkplacesResponse{
    repeated Workplace workplaces = 1;
    uint32 total_count = 2;
}

message GetProcessGraphRequest{
    string simulation_id = 1;
    int32 step = 2;
}

message CreateConsumerRequest{
    string name = 1;
    string type = 2;
}

message UpdateConsumerRequest{
    string consumer_id = 1;
    string name = 2;
    string type = 3;
}

message DeleteConsumerRequest{
    string consumer_id = 1;
}

message GetAllConsumersResponse{
    repeated Consumer consumers = 1; 
    uint32 total_count = 2; 
}

message CreateTenderRequest {
    string consumer_id = 1;
    uint32 cost = 2;
    uint32 quantity_of_products = 3;
    uint32 penalty_per_day = 4;
    uint32 warranty_years = 5;
    string payment_form = 6;
}

message UpdateTenderRequest {
    string tender_id = 1;
    string consumer_id = 2;
    uint32 cost = 3;
    uint32 quantity_of_products = 4;
    uint32 penalty_per_day = 5;
    uint32 warranty_years = 6;
    string payment_form = 7;
}

message DeleteTenderRequest {
    string tender_id = 1;
}

message GetAllTendersResponse {
    repeated Tender tenders = 1; 
    uint32 total_count = 2; 
}

message GetAllSuppliersRequest{}

message GetAllWorkersRequest{}

message GetAllLogistsRequest{}

message GetAllWorkplacesRequest{}

message GetAllConsumersRequest{}

message GetAllTendersRequest{}

message PingRequest{}

message CreateEquipmentRequest{
    string name = 1;
    string equipment_type = 2;
    double reliability = 3;
    uint32 maintenance_period = 4;
    uint32 maintenance_cost = 5;
    uint32 cost = 6;
    uint32 repair_cost = 7;
    uint32 repair_time = 8;
}

message UpdateEquipmentRequest{
    string equipment_id = 1; 
    string name = 2;
    string equipment_type = 3;
    double reliability = 4;
    uint32 maintenance_period = 5;
    uint32 maintenance_cost = 6;
    uint32 cost = 7;
    uint32 repair_cost = 8;
    uint32 repair_time = 9;
}

message DeleteEquipmentRequest {
    string equipment_id = 1;
}

message GetAllEquipmentRequest{}

message GetAllEquipmentResopnse {
    repeated Equipment equipments = 1; 
    uint32 total_count = 2; 
}

// -----------------------------------------------------------------
//          Запросы для мониторинга
// -----------------------------------------------------------------

message GetMetricsRequest {
    string simulation_id = 1;
    uint32 step = 2;
}

message FactoryMetricsResponse {
    FactoryMetrics metrics = 1;
    string timestamp = 2;
}

message ProductionMetricsResponse {
    ProductionMetrics metrics = 1;
    UnplannedRepair unplanned_repairs = 2;
    string timestamp = 3;
}

message QualityMetricsResponse {
    QualityMetrics metrics = 1;
    string timestamp = 2;
}

message EngineeringMetricsResponse {
    EngineeringMetrics metrics = 1;
    OperationTimingChart operation_timing_chart = 2;
    DowntimeChart downtime_chart = 3;
    string timestamp = 4;
}

message CommercialMetricsResponse {
    CommercialMetrics metrics = 1;
    ModelMasteryChart model_mastery_chart = 2;
    ProjectProfitabilityChart project_profitability_chart = 3;
    string timestamp = 4;
}

message ProcurementMetricsResponse {
    ProcurementMetrics metrics = 1;
    string timestamp = 2;
}

message GetProductionScheduleRequest {
    string simulation_id = 1;
}

message ProductionScheduleResponse {
    ProductionSchedule schedule = 1;
    string timestamp = 2;
}


message GetWorkshopPlanRequest {
    string simulation_id = 1;
}

message WorkshopPlanResponse {
    ProcessGraph workshop_plan = 1;  // План цеха (используется ProcessGraph)
    string timestamp = 2;
}

message GetUnplannedRepairRequest {
    string simulation_id = 1;
}

message UnplannedRepairResponse {
    UnplannedRepair unplanned_repair = 1;
    string timestamp = 2;
}

message GetWarehouseLoadChartRequest {
    string simulation_id = 1;
    string warehouse_id = 2;
}

message WarehouseLoadChartResponse {
    WarehouseLoadChart chart = 1;
    string timestamp = 2;
}

message SetQualityInspectionRequest {
    string simulation_id = 1;
    string supplier_id = 2;  // ID поставщика
    bool inspection_enabled = 3;  // включить/выключить контроль качества
}

message SetDeliveryPeriodRequest {
    string simulation_id = 1;
    string supplier_id = 2;  // ID поставщика
    uint32 delivery_period_days = 3;  // период поставок в днях
}


message SetEquipmentMaintenanceIntervalRequest {
    string simulation_id = 1;
    string equipment_id = 2;
    uint32 interval_days = 3;
}

message SetCertificationStatusRequest {
    string simulation_id = 1;
    string certificate_type = 2;
    bool is_obtained = 3;
}

message SetLeanImprovementStatusRequest {
    string simulation_id = 1;
    string name = 2;
    bool is_implemented = 3;
}

message SetSalesStrategyRequest {
    string simulation_id = 1;
    string strategy = 2;
}

message GetRequiredMaterialsRequest {
    string simulation_id = 1;
}

message RequiredMaterialsResponse {
    repeated RequiredMaterial materials = 1;
    string timestamp = 2;
}

message GetAvailableImprovementsRequest {
    string simulation_id = 1;
}

message AvailableImprovementsResponse {
    repeated LeanImprovement improvements = 1;
    string timestamp = 2;
}

message GetDefectPoliciesRequest {
    string simulation_id = 1;
}

message DefectPoliciesResponse {
    repeated string available_policies = 1;
    string current_policy = 2;
    string timestamp = 3;
}


message GetAllMetricsRequest {
    string simulation_id = 1;
    uint32 step = 2;
}

message AllMetricsResponse {
    FactoryMetrics factory = 1;
    ProductionMetrics production = 2;
    QualityMetrics quality = 3;
    EngineeringMetrics engineering = 4;
    CommercialMetrics commercial = 5;
    ProcurementMetrics procurement = 6;
    string timestamp = 7;
}

message ValidateConfigurationRequest {
    string simulation_id = 1;
}

message ValidationResponse {
    bool is_valid = 1;
    repeated string errors = 2;
    repeated string warnings = 3;
    string timestamp = 4;
}

// -----------------------------------------------------------------
//          Сервисы
// -----------------------------------------------------------------

service SimulationService{
    // Базовые методы симуляции
    rpc create_simulation(CreateSimulationRquest) returns (SimulationResponse);
    rpc get_simulation(GetSimulationRequest) returns (SimulationResponse);
    rpc run_simulation(RunSimulationRequest) returns (SimulationResponse);
    
    // Конфигурация персонала
    rpc set_logist(SetLogistRequest) returns (SimulationResponse);
    rpc set_warehouse_inventory_worker(SetWarehouseInventoryWorkerRequest) returns (SimulationResponse);
    rpc set_worker_on_workerplace(SetWorkerOnWorkerplaceRequest) returns (SimulationResponse);
    rpc unset_worker_on_workerplace(UnSetWorkerOnWorkerplaceRequest) returns (SimulationResponse);
    
    // Конфигурация поставщиков
    rpc add_supplier(AddSupplierRequest) returns (SimulationResponse);
    rpc delete_supplier(DeleteSupplierRequest) returns (SimulationResponse);
    
    // Конфигурация складов
    rpc increase_warehouse_size(IncreaseWarehouseSizeRequest) returns (SimulationResponse);
    
    // Конфигурация процесса (Инженеринг)
    // Управление графом процесса (все изменения графа через один метод)
    rpc update_process_graph(UpdateProcessGraphRequest) returns (SimulationResponse);
    
    // Распределение производственного плана (Производство)
    rpc set_production_plan_row(SetProductionPlanRowRequest) returns (SimulationResponse);
    
    // Конфигурация тендеров
    rpc add_tender(AddTenderRequest) returns (SimulationResponse);
    rpc delete_tender(RemoveTenderRequest) returns (SimulationResponse);
    
    // Общие настройки
    rpc set_dealing_with_defects(SetDealingWithDefectsRequest) returns (SimulationResponse);
    rpc set_lean_improvement_status(SetLeanImprovementStatusRequest) returns (SimulationResponse);
    rpc set_sales_strategy(SetSalesStrategyRequest) returns (SimulationResponse);
    
    // Специфичные настройки по ролям
    rpc set_quality_inspection(SetQualityInspectionRequest) returns (SimulationResponse);
    rpc set_delivery_period(SetDeliveryPeriodRequest) returns (SimulationResponse);
    rpc set_equipment_maintenance_interval(SetEquipmentMaintenanceIntervalRequest) returns (SimulationResponse);
    rpc set_certification_status(SetCertificationStatusRequest) returns (SimulationResponse);
    
    // Методы получения метрик и мониторинга
    rpc get_factory_metrics(GetMetricsRequest) returns (FactoryMetricsResponse);
    rpc get_production_metrics(GetMetricsRequest) returns (ProductionMetricsResponse);
    rpc get_quality_metrics(GetMetricsRequest) returns (QualityMetricsResponse);
    rpc get_engineering_metrics(GetMetricsRequest) returns (EngineeringMetricsResponse);
    rpc get_commercial_metrics(GetMetricsRequest) returns (CommercialMetricsResponse);
    rpc get_procurement_metrics(GetMetricsRequest) returns (ProcurementMetricsResponse);
    rpc get_all_metrics(GetAllMetricsRequest) returns (AllMetricsResponse);
    
    // Методы получения данных для вкладок
    rpc get_production_schedule(GetProductionScheduleRequest) returns (ProductionScheduleResponse);
    rpc get_workshop_plan(GetWorkshopPlanRequest) returns (WorkshopPlanResponse);
    rpc get_unplanned_repair(GetUnplannedRepairRequest) returns (UnplannedRepairResponse);
    rpc get_warehouse_load_chart(GetWarehouseLoadChartRequest) returns (WarehouseLoadChartResponse);
    rpc get_required_materials(GetRequiredMaterialsRequest) returns (RequiredMaterialsResponse);
    rpc get_available_improvements(GetAvailableImprovementsRequest) returns (AvailableImprovementsResponse);
    rpc get_defect_policies(GetDefectPoliciesRequest) returns (DefectPoliciesResponse);
    
    // Справочные данные
    rpc get_material_types(GetMaterialTypesRequest) returns (MaterialTypesResponse);
    rpc get_equipment_types(GetEquipmentTypesRequest) returns (EquipmentTypesResponse);
    rpc get_workplace_types(GetWorkplaceTypesRequest) returns (WorkplaceTypesResponse);
    rpc get_available_defect_policies(GetAvailableDefectPoliciesRequest) returns (DefectPoliciesListResponse);
    rpc get_available_improvements_list(GetAvailableImprovementsListRequest) returns (ImprovementsListResponse);
    rpc get_available_certifications(GetAvailableCertificationsRequest) returns (CertificationsListResponse);
    rpc get_available_sales_strategies(GetAvailableSalesStrategiesRequest) returns (SalesStrategiesListResponse);
    
    // Валидация
    rpc validate_configuration(ValidateConfigurationRequest) returns (ValidationResponse);
    
    // Проверка сервиса
    rpc ping(PingRequest) returns (SuccessResponse);
}

service SimulationDatabaseManager{
    // методы поставщика
    rpc create_supplier(CreateSupplierRequest) returns (Supplier);
    rpc update_supplier(UpdateSupplierRequest) returns (Supplier);
    rpc delete_supplier(DeleteSupplierRequest) returns (SuccessResponse);
    rpc get_all_suppliers(GetAllSuppliersRequest) returns (GetAllSuppliersResponse);

    // методы склада
    rpc get_warehouse(GetWarehouseRequest) returns (Warehouse);

    // методы рабочих
    rpc create_worker(CreateWorkerRequest) returns (Worker);
    rpc update_worker(UpdateWorkerRequest) returns (Worker);
    rpc delete_worker(DeleteWorkerRequest) returns (SuccessResponse);
    rpc get_all_workers(GetAllWorkersRequest) returns (GetAllWorkersResponse);

    // методы логиста
    rpc create_logist(CreateLogistRequest) returns (Logist);
    rpc update_logist(UpdateLogistRequest) returns (Logist);
    rpc delete_logist(DeleteLogistRequest) returns (SuccessResponse);
    rpc get_all_logists(GetAllLogistsRequest) returns (GetAllLogistsResponse);

    // методы рабочих мест 
    rpc create_workplace(CreateWorkplaceRequest) returns (Workplace);
    rpc update_workplace(UpdateWorkplaceRequest) returns (Workplace);
    rpc delete_workplace(DeleteWorkplaceRequest) returns (SuccessResponse);
    rpc get_all_workplaces(GetAllWorkplacesRequest) returns (GetAllWorkplacesResponse);

    // методы карты процесса 
    rpc get_process_graph(GetProcessGraphRequest) returns (ProcessGraph);

    // методы заказчика
    rpc create_consumer(CreateConsumerRequest) returns (Consumer);
    rpc update_consumer(UpdateConsumerRequest) returns (Consumer);
    rpc delete_consumer(DeleteConsumerRequest) returns (SuccessResponse);
    rpc get_all_consumers(GetAllConsumersRequest) returns (GetAllConsumersResponse);

    // методы тендеров
    rpc create_tender(CreateTenderRequest) returns (Tender);
    rpc update_tender(UpdateTenderRequest) returns (Tender);
    rpc delete_tender(DeleteTenderRequest) returns (SuccessResponse);
    rpc get_all_tenders(GetAllTendersRequest) returns (GetAllTendersResponse);

    // методы оборудования
    rpc create_equipment(CreateEquipmentRequest) returns (Equipment);
    rpc update_equipment(UpdateEquipmentRequest) returns (Equipment);
    rpc delete_equipment(DeleteEquipmentRequest) returns (SuccessResponse);
    rpc get_all_equipment(GetAllEquipmentRequest) returns (GetAllEquipmentResopnse);

    // методы LEAN улучшений
    rpc create_lean_improvement(CreateLeanImprovementRequest) returns (LeanImprovement);
    rpc update_lean_improvement(UpdateLeanImprovementRequest) returns (LeanImprovement);
    rpc delete_lean_improvement(DeleteLeanImprovementRequest) returns (SuccessResponse);
    rpc get_all_lean_improvements(GetAllLeanImprovementsRequest) returns (GetAllLeanImprovementsResponse);

    // Справочные данные
    rpc get_available_material_types(GetMaterialTypesRequest) returns (MaterialTypesResponse);
    rpc get_available_equipment_types(GetEquipmentTypesRequest) returns (EquipmentTypesResponse);
    rpc get_available_workplace_types(GetWorkplaceTypesRequest) returns (WorkplaceTypesResponse);
    rpc get_available_defect_policies(GetAvailableDefectPoliciesRequest) returns (DefectPoliciesListResponse);
    rpc get_available_improvements_list(GetAvailableImprovementsListRequest) returns (ImprovementsListResponse);
    rpc get_available_certifications(GetAvailableCertificationsRequest) returns (CertificationsListResponse);
    rpc get_available_sales_strategies(GetAvailableSalesStrategiesRequest) returns (SalesStrategiesListResponse);
    rpc get_available_lean_improvements(GetAvailableLeanImprovementsRequest) returns (GetAvailableLeanImprovementsResponse);

    // методы проверки состояния
    rpc ping(PingRequest) returns (SuccessResponse);
}